# Plan: Fix Profile Errors and Instagram-Like Redesign

## Problem Summary

When clicking on a user from search results, the profile screen fails to load with error:
```
Error fetching profile: [Error: Failed to fetch profile]
```

Additionally, the user wants the profile screen redesigned to be Instagram-like without posts.

## Root Causes Identified

### 1. URL Issues in `profile/[userId].tsx`
- **Line 46**: Uses relative URL `/api/social/profiles/${userId}`
  - Mobile needs absolute URL with `API_CONFIG.BASE_URL`
- **Lines 65-77**: Follow/unfollow also use relative URLs
  - `/api/social/follows?followingId=${userId}`
  - `/api/social/follows`

### 2. Field Name Mismatches
Backend returns:
- `display_name`, `email`, `avatar_url`, `bio`, `website`, `location`
- `followers_count`, `following_count`, `is_verified`, `is_followed`

Mobile code expects:
- `full_name`, `username` (incorrect)

### 3. UI Design
Current profile is basic, needs Instagram-like design with:
- Circular avatar with verification badge
- Bio section
- Stats row (posts/followers/following)
- Action buttons (Follow/Message/More)
- Grid layout placeholder (no posts, but structure ready)

## Implementation Steps

### Step 1: Fix URL Fetching Issues
**File**: `app/(app)/profile/[userId].tsx`

1. Add API_CONFIG import:
   ```typescript
   import { API_CONFIG } from '../../../lib/config';
   ```

2. Fix profile fetch (line 46):
   ```typescript
   const response = await fetch(`${API_CONFIG.BASE_URL}/api/social/profiles/${userId}`);
   ```

3. Fix follow/unfollow URLs (lines 65-77):
   ```typescript
   // Unfollow
   const url = `${API_CONFIG.BASE_URL}/api/social/follows?followingId=${userId}`;

   // Follow
   const url = `${API_CONFIG.BASE_URL}/api/social/follows`;
   ```

### Step 2: Fix Field Name Mapping
**File**: `app/(app)/profile/[userId].tsx`

Update profile state interface and mapping:
```typescript
interface UserProfile {
  id: string;
  display_name: string;  // Changed from full_name
  email: string;         // Changed from username
  avatar_url?: string;
  bio?: string;
  website?: string;
  location?: string;
  followers_count: number;
  following_count: number;
  is_verified: boolean;
  is_followed: boolean;
}
```

Map backend response correctly:
```typescript
setProfile({
  id: data.id,
  display_name: data.display_name,
  email: data.email,
  avatar_url: data.avatar_url,
  bio: data.bio,
  website: data.website,
  location: data.location,
  followers_count: data.followers_count || 0,
  following_count: data.following_count || 0,
  is_verified: data.is_verified || false,
  is_followed: data.is_followed || false,
});
```

### Step 3: Redesign Profile UI (Instagram-like)

**Layout Structure**:

1. **Header Section**
   - Avatar (96x96) with circular shape
   - Verification badge overlay if `is_verified`
   - Display name (bold, large)
   - Email/username (gray, small)

2. **Stats Row**
   - Followers count (clickable)
   - Following count (clickable)
   - Posts count: 0 (disabled/gray)
   - Horizontal layout with equal spacing

3. **Bio Section**
   - Bio text (if available)
   - Website link (if available)
   - Location (if available)
   - Each on separate lines

4. **Action Buttons Row**
   - Primary button: Follow/Following (full width or 70%)
   - Secondary button: Message (icon or text)
   - More options button (three dots icon)

5. **Tabs Section** (Empty State)
   - Single tab "Post" (disabled)
   - Empty state message: "Nessun post ancora"
   - Grid icon placeholder

**Design Tokens**:
- Border radius: rounded-full for avatar
- Spacing: p-4 for main container, gap-4 between sections
- Typography: font-bold for name, text-muted-foreground for secondary
- Colors: Use theme colors (primary, muted, foreground)

### Step 4: Update Component Structure

```typescript
return (
  <SafeAreaView className="flex-1 bg-background">
    <ScrollView>
      {/* Header */}
      <View className="flex-row items-center justify-between px-4 py-3 border-b border-border">
        <TouchableOpacity onPress={() => router.back()}>
          <ArrowLeft />
        </TouchableOpacity>
        <Text className="font-bold">{profile?.display_name}</Text>
        <View className="w-6" />
      </View>

      {/* Profile Info Section */}
      <View className="p-4">
        {/* Avatar & Name */}
        <View className="flex-row items-center gap-4 mb-4">
          <View className="relative">
            <Avatar className="h-24 w-24">
              <AvatarImage source={{ uri: profile?.avatar_url }} />
              <AvatarFallback>
                <Text>{profile?.display_name.charAt(0).toUpperCase()}</Text>
              </AvatarFallback>
            </Avatar>
            {profile?.is_verified && (
              <View className="absolute bottom-0 right-0 bg-blue-500 rounded-full p-1">
                <CheckCircle2 size={16} color="white" />
              </View>
            )}
          </View>

          <View className="flex-1">
            <Text className="text-xl font-bold">{profile?.display_name}</Text>
            <Text className="text-sm text-muted-foreground">@{profile?.email.split('@')[0]}</Text>
          </View>
        </View>

        {/* Stats Row */}
        <View className="flex-row justify-around py-4 border-y border-border">
          <View className="items-center">
            <Text className="text-xl font-bold">0</Text>
            <Text className="text-xs text-muted-foreground">Post</Text>
          </View>
          <TouchableOpacity
            className="items-center"
            onPress={() => router.push(`/followers/${userId}` as any)}
          >
            <Text className="text-xl font-bold">{profile?.followers_count}</Text>
            <Text className="text-xs text-muted-foreground">Follower</Text>
          </TouchableOpacity>
          <TouchableOpacity
            className="items-center"
            onPress={() => router.push(`/following/${userId}` as any)}
          >
            <Text className="text-xl font-bold">{profile?.following_count}</Text>
            <Text className="text-xs text-muted-foreground">Seguiti</Text>
          </TouchableOpacity>
        </View>

        {/* Bio Section */}
        {(profile?.bio || profile?.website || profile?.location) && (
          <View className="py-4 gap-2">
            {profile.bio && (
              <Text className="text-sm">{profile.bio}</Text>
            )}
            {profile.website && (
              <Text className="text-sm text-blue-500">{profile.website}</Text>
            )}
            {profile.location && (
              <View className="flex-row items-center gap-1">
                <MapPin size={14} className="text-muted-foreground" />
                <Text className="text-sm text-muted-foreground">{profile.location}</Text>
              </View>
            )}
          </View>
        )}

        {/* Action Buttons */}
        <View className="flex-row gap-2 mt-4">
          <Button
            variant={profile?.is_followed ? 'outline' : 'default'}
            onPress={handleFollowToggle}
            className="flex-1"
          >
            <Text>{profile?.is_followed ? 'Seguendo' : 'Segui'}</Text>
          </Button>
          <Button variant="outline" className="flex-1">
            <Text>Messaggio</Text>
          </Button>
          <Button variant="outline" className="px-4">
            <MoreHorizontal size={20} />
          </Button>
        </View>
      </View>

      {/* Empty Posts Section */}
      <View className="border-t border-border">
        <View className="p-8 items-center">
          <Grid3x3 size={64} className="text-muted-foreground mb-4" />
          <Text className="text-muted-foreground">Nessun post ancora</Text>
        </View>
      </View>
    </ScrollView>
  </SafeAreaView>
);
```

### Step 5: Add Missing Imports

```typescript
import { ArrowLeft, CheckCircle2, MapPin, Grid3x3, MoreHorizontal } from 'lucide-react-native';
import { API_CONFIG } from '../../../lib/config';
```

### Step 6: Test Complete Flow

1. Open app → Navigate to Search tab
2. Search for a user by name
3. Click on user from search results
4. Verify profile loads successfully
5. Test follow/unfollow button
6. Test navigation to followers/following screens
7. Verify all data displays correctly

## Success Criteria

- ✅ Profile loads without errors when clicking user from search
- ✅ All API calls use absolute URLs with API_CONFIG.BASE_URL
- ✅ Field names match backend response (display_name, email)
- ✅ Follow/unfollow functionality works
- ✅ Profile UI looks Instagram-like with proper spacing and layout
- ✅ Stats are clickable and navigate to respective screens
- ✅ Verification badge shows for verified users
- ✅ Empty state shows for posts section

## Files to Modify

1. `app/(app)/profile/[userId].tsx` - Main profile screen
   - Fix URL fetching
   - Fix field mapping
   - Redesign UI layout

## Estimated Changes

- ~150 lines modified in profile/[userId].tsx
- Add 5 new icon imports
- Update 3 fetch calls
- Restructure entire render method
